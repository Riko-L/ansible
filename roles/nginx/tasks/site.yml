---
- name: Creation du dossier
  become: yes
  when: item.repo is undefined
  file: path=/home/{{ user }}/{{ item.domain }} state=directory owner={{ user }}

- name: Clonnage du site {{ item.domain }} depuis {{ item.repo }}
  become: yes
  when: item.repo is defined
  git: dest=/home/{{ user }}/{{ item.domain }} clone=yes repo={{ item.repo }}

- name: Lien vers www
  become: yes
  file: src=/home/{{ user }}/{{ item.domain }} dest=/var/www/{{ item.domain }} state=link

- name: Cr√©ation de la configuration nginx
  become: yes
  template: src=templates/nginx.j2 dest=/etc/nginx/sites-available/{{ item.domain }} force=yes
  notify: nginx reload

- name: Activation du domain {{ item.domain }}
  become: yes
  file: src=/etc/nginx/sites-available/{{ item.domain }} dest=/etc/nginx/sites-enabled/{{ item.domain }} state=link
  notify: nginx reload

- name: test
  shell: composer install
  args:
    chdir: /home/{{ user }}/{{ item.domain }}/

...